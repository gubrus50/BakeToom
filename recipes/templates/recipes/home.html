{% extends "recipes/base.html" %}
{% load recipes_extras %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'recipes/css/home.css' %}">
<style>
#recipes {
  background-image: url('{% static 'recipes/img/background_notepad.png' %}');
  background-size: 15px 15px;
}
/*-- Search Form --*/
#previous-page-btn {
  border-radius: 0;
  height: 38px;
  outline: none;
  box-shadow: none;
  display: flex;
  flex-direction: column;
  justify-content: center;
  font-size: 20px;
}
.form-control {
  border-radius: 0;
  width: 70% !important;
  height: 38px;
}
.form-control > input[type="search"] {
  border: 0;
  width: 90%;
  outline: none;
  box-shadow: none;
}
#search-form > button[name="search-query"] {
  border-radius: 0;
  height: 38px;
  outline: none;
  box-shadow: none;
}
#search-form > div[name="filter-container"] {
  margin: 20px 10% 0px 10%;
  display: none;
}
</style>
{% endblock %}
{% block content %}


  <form id="search-form" method="GET" action="{% url 'recipes-home' %}" class="container form-inline my-4 d-flex justify-content-center h-mobile">
    <a id="previous-page-btn" href="javascript:if(window.location.href!=window.location.origin+'/'){history.back()}" class="btn text-secondary">
      <i class="fa fa-arrow-left"></i>
    </a>
    <div class="form-control">
      <input type="search" name="q" value="{{ query }}" placeholder="Czego dzisiaj pragniesz?" aria-label="Search">
      <a id="search-filter-btn" href="#filter" class="text-secondary float-right">
        <i class="fas fa-filter"></i>
      </a>
    </div>
    <button name="search-query" type="submit" class="btn btn-outline-secondary">
      <i>Wyszukaj</i><i class="d-none fa fa-search"></i>
    </button>
    <div name="filter-container">
      <ul class="list-inline">
        <li name="search-by" class="list-inline-item">
          <h5 class="h4-mobile">Szukaj według</h5><hr>
          <ul name="search-by-children">
            <li><input type="checkbox" name="title" value="true" checked> nazwy przepisu</li>
            <li><input type="checkbox" name="publisher" value="true" checked> nazwy wydawcy</li>
            <li><input type="checkbox" name="certified" value="true"> tylko certyfikowe</li>
            <li><input type="checkbox" name="search_by_date" value="DOC"> daty utworzenia</li>
            <li><input type="checkbox" name="id" value="true"> id przepisu</li>
          </ul>
        </li>
        <li name="upload-date" class="list-inline-item">
          <h5 class="h4-mobile">Data przesłania</h5><hr>
          <ul name="upload-date-children">
            <li><input type="radio" name="search_by_date" value="GUD" checked> obojętna</li>
            <li><input type="radio" name="search_by_date" value="TUD"> dzisiejsza</li>
            <li><input type="radio" name="search_by_date" value="TWUD"> tego tygodnia</li>
            <li><input type="radio" name="search_by_date" value="TMUD"> tego miesiąca</li>
            <li><input type="radio" name="search_by_date" value="TYUD"> tego rocznika</li>
          </ul>
        </li>
        <li name="categories" class="list-inline-item">
          <h5 class="h4-mobile">Kategorie</h5><hr>
          <ul name="categories-children">
            <li><input type="radio" name="type" value="general" checked> ogólne</li>
            <li><input type="radio" name="type" value="wypiek"> wypieki</li>
            <li><input type="radio" name="type" value="deser"> desery</li>
            <li><input type="radio" name="type" value="zupa"> zupy</li>
            <li><input type="radio" name="type" value="inne"> inne</li>
          </ul>
        </li>
        <li name="nationality" class="list-inline-item">
          <h5 class="h4-mobile">Narodowość</h5><hr>
          <ul name="nationality-children">
            <li><input type="radio" name="nationality_mode" value="general" checked> ogólna</li>
            <li><input type="radio" name="nationality_mode" value="international"> międzynarodowa</li>
            <li><input type="radio" name="nationality_mode" value="specific"> specyficzna</li>
            <li><select class="selectpicker countrypicker custom-scroll d-none" name="nationality" data-default="PL" data-flag="true"></select></li>
          </ul>
        </li>
      </ul>
    </div>
  </form>


  <!-- Recipes container -->
  <div id="recipes" class="mt-4 mb-5 pt-4 pb-4">
    <center class="container recipe-container">
      {% if recipes %}
        {% for recipe in recipes %}
          {% if recipe.published %}
            <div class="btn-light" onclick="$(this).fadeOut(500); setTimeout(function(){window.location='{% url 'recipe-detail' recipe.id %}'}, 500)">
                
              <div class="row m-auto py-3 px-3">
                <div class="recipe-detail col-lg-10 px-0">
                  <h3 class="text-uppercase w-100" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 400">{{ recipe.title }}</h3><hr>
                  <p class="mr-2">{{ recipe.description }}</p>
                </div>
                <div class="recipe-image col-lg-2 m-0 px-0">
                  <img class="border" width="150px" height="150px" src="{{ recipe.image.url }}">
                </div>
                <span class="f16 mt-2" style="font-weight: 500; font-family: monospace">
                  <ul class="recipe-data list-inline">
                    <li class="list-inline-item m-0">
                      {% if recipe.nationality %}
                        narodowość:
                        <li class="flag {{ recipe.nationality|lower }}"></li>
                      {% else %}
                        narodowość: międzynarodowy
                      {% endif %}
                    </li>
                    <msg class="w-off-767">-</msg>
                    <li class="list-inline-item m-0">
                      {% if recipe.publisher %}
                        wydawca: <a href="{% url 'user-recipes' recipe.publisher.username %}">{{ recipe.publisher }}</a> 
                      {% else %}
                        wydawca: null 
                      {% endif %}
                    </li>
                    <msg class="w-off-767">-</msg>
                    <li class="list-inline-item m-0">
                      {% if recipe.recipe_type %}
                        typ: {{ recipe.recipe_type }}
                      {% else %}
                        typ: inne
                      {% endif %}
                    </li>
                    <msg class="w-off-767">-</msg>
                    <li class="list-inline-item m-0">
                      id_przepisu: {{ recipe.id }}
                      {% if recipe.certified %}
                        <img class="float-right" height="30" src="{% static 'recipes/img/icons/flaticon/contract.svg' %}" />
                      {% endif %}
                    </li>
                </span>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <!-- No results msg -->
        <div class="d-flex justify-content-center text-dark p-5 text-center h-mobile" style="background-color: #f8f9fa">
          <h2>Zero rezultatów</h2>
        </div>
      {% endif %}
    </center>
  </div>



  {% if is_paginated %}
    <!-- Pagination -->
    <center class="pagination justify-content-center">
      <nav id="home-pagination" aria-label="Page navigation example">

        <div>
          <ul class="pagination pagination-circle pg-blue mb-0">
            <!-- To first page -->
            <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
              <a class="page-link" style="border-right: 0" aria-label="First"
              
                {% if page_obj.has_previous %}
                  {% if request.GET.nationality %}
                    href="#"
                    onclick="paginateToPage(1)"
                  {% else %}
                    href="?page=1"
                  {% endif %}
                {% else %}
                  href="#"
                {% endif %}

              >Początek</a>
            </li>
            <!-- Direct page choice -->
            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active">
                  <a class="page-link page-link-active-fancy"

                    {% if request.GET.nationality %}
                      href="#"
                      onclick="paginateToPage({{ num }})"
                    {% else %}
                      href="?page={{ num }}"
                    {% endif %}
                  
                  >{{ num }}</a>
                </li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                  <a class="page-link page-link-fancy"

                    {% if request.GET.nationality %}
                      href="#"
                      onclick="paginateToPage({{ num }})"
                    {% else %}
                      href="?page={{ num }}"
                    {% endif %}
                  
                  >{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}
            <!-- To last page -->
            <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
              <a class="page-link" style="border-left: 0" aria-label="Last"

                {% if page_obj.has_next %}
                  {% if request.GET.nationality %}
                    href="#"
                    onclick="paginateToPage({{ page_obj.paginator.num_pages }})"
                  {% else %}
                    href="?page={{ page_obj.paginator.num_pages }}"
                  {% endif %}
                {% else %}
                  href="#"
                {% endif %}

              >Koniec</a>
            </li>
          </ul>
        </div>

        <div name="page-flip">
          <!-- Previous page action -->
          <a style="border-right: 0" class="{% if not page_obj.has_previous %}disabled{% endif %}" aria-label="Previous"

            {% if page_obj.has_previous %}
              {% if request.GET.nationality %}
                href="#"
                onclick="paginateToPage({{ page_obj.previous_page_number }})"
              {% else %}
                href="?page={{ page_obj.previous_page_number }}"
              {% endif %}
            {% else %}
              href="#"
            {% endif %}

          ><span aria-hidden="true">&laquo;</span></a>

          <!-- Result counter -->
          <a style="width: 60%; border-left: 0; border-right: 0; color: #6c757d; cursor: default">
            <span id="search-result-counter">{{ page_obj.paginator.count }}</span>
              rezultatów
          </a>

          <!-- Next page action -->
          <a style="border-left: 0" class="{% if not page_obj.has_next %}disabled{% endif %}" aria-label="Next"

            {% if page_obj.has_next %}
              {% if request.GET.nationality %}
                href="#"
                onclick="paginateToPage({{ page_obj.next_page_number }})"
              {% else %}
                href="?page={{ page_obj.next_page_number }}"
              {% endif %}
            {% else %}
              href="#"
            {% endif %}

          ><span aria-hidden="true">&raquo;</span></a>
        </div>

      </nav>
    </center>
    <!-- End of Pagination -->
  {% endif %}
{% endblock content %}
{% block base %}
<script name="main.js" src="{% static 'recipes/js/filter_search_with_pagination.js' %}" crossorigin="anonymous"></script>
{% endblock %}